import {
    FileLoader,
    Group,
    InstancedMesh,
    LoadingManager,
    Matrix4,
    Vector3
} from "./three/build/three";
import {ZipLoader} from "./ziploader";
import {GLTFLoader} from "./three/examples/jsm/loaders/GLTFLoader";
import $ from "jquery"

export class SceneManager{
    constructor(viewer){
    	this.viewer = viewer
        this.projectName = window.projectName
        this.scene = window.scene
        this.camera = window.camera
        this.instanceGroup = new Group()
        this.scene.add(this.instanceGroup)
        this.matrixWorld = null

        this.visibleModelList = []

        // this.loadingModelList = [
        //     3465,2804,3547,2500,3475,3474,2504,2488,3548,3546,3576,2951,2839,2816,2949,2803,3533,2894,2892,3489,2795,3480,2543,2883,2882,2889,2957,3097,2812,2880,2809,2891,2888,2881,2810,2952,2884,2877,3476,2887,2875,2811,2893,2896,2874,2885,2873,2813,2396,2824,2113,2821,2814,2518,2863,2823,2870,2822,2871,2876,2963,730,2833,2895,2858,2818,2865,2515,2890,3550,2872,3551,2817,3485,2506,2878,2815,2886,2825,3560,2864,2806,2869,2519,2397,2827,2867,2807,3559,2829,3552,3557,3014,2499,2808,2828,2498,2842,2857,2879,3553,3555,2805,732,2819,2950,2849,2835,2830,2846,2856,2847,2861,2590,743,3132,2848,2862,2838,2841,2852,2520,2565,2860,2959,2834,2486,2832,2820,2487,2859,738,2868,2501,2866,3554,741,2826,2854,2505,2502,2964,2494,2503,3544,3537,2851,3055,3575,2489,2837,2844,2529,2831,3041,745,3498,728,2897,2576,3419,2855,3013,3541,2898,2850,3556,2107,2903,3539,744,2853,3026,2538,3134,3486,3028,2342,2905,2904,3086,729,826,2496,2845,2930,2962,1630,2484,3120,3133,2836,2958,2341,3572,2263,2843,2415,2340,2091,2447,2840,3534,2448,2900,726,3095,3098,3558,2544,2398,2411,3418,2115,2899,3087,3490,3497,3131,890,3569,3574,2522,2526,747,3432,3021,3477,1888,602,3500,3527,737,2492,2525,2416,3479,2524,3452,2801,2100,2521,724,3542,1979,3457,2045,3492,2932,3567,3088,2523,3535,2410,3112,2935,3487,725,2038,1174,734,3570,2449,3571,3488,748,2493,378,2264,3287,3481,3562,2259,2585,736,2497,173,2938,2258,3563,829,381,2924,2105,379,2427,2928,2262,3573,2441,2639,2907,695,2925,2941,2041,2917,2902,3090,197,2901,2037,2921,2249,380,3568,2995,2531,2495,2636,3460,2539,2796,2915,370,1642,3478,821,1651,770,2485,2587,3506,751,2561,2564,697,3122,2916,154,3012,3454,2787,2532,3504,2920,2278,2562,2216,3003,2558,803,2362,176,3005,3142,824,1195,2154,2559,2220,3549,2575,167,3042,2507,3459,2594,2084,1975,175,367,3499,181,2527,120,2083,3089,1980,2516,1231,25,1978,2579,2106,2148,2595,1232,2584,2339,1225,1220,2082,164,2276,2344,122,376,196,2572,3493,2797,2094,50,186,155,3540,2114,1774,2490,771,789,785,2510,596,3318,2430,194,2431,2434,3505,2433,2517,3528,2567,3536,2432,693,2914,2931,3011,2438,3141,2435,2412,1188,128,2437,2436,2102,2421,777,3006,2440,2439,2965,77,2939,1951,2092,2927,2413,2043,2414,2923,2401,2420,2422,2423,805,2081,2425,2424,2426,2036,700,2404,2994,2399,2406,3128,3129,178,3130,2400,2405,80,162,2407,2403,1167,2408,2409,2479,3545,773,3507,158,3491,1165,3496,1557,177,2101,3483,1199,2940,198,371,3443,1893,2369,2911,3147,2044,1163,3543,759,3482,735,3047,2291,3538,2261,2996,3068,606,3502,2343,3515,2786,1257,3503,3561,827,698,3121,1172,185,2305,188,107,3564,2112,2906,1898,180,2483,2455,127,2103,388,3073,2104,2465,752,3275,172,2802,2475,699,614,179,2469,2948,2480,2281,1161,2275,2574,3531,383,2968,521,2093,199,2010,2389,2035,2937,2443,2598,3015,2910,1905,2551,513,189,2418,2442,522,714,2089,3484,2528,3495,3143,876,2360,2070,911,1193,195,2085,106,2557,1138,3146,2152,3525,2269,1171,2513,3139,3494,3081,2108,2363,1185,163,115,3501,2922,2926,2668,484,3039,1154,1156,2975,2953,778,779,2578,786,148,2277,2792,157,2919,19,165,1229,1921,132,2361,2350,2566,2370,2560,2030,489,3060,1139,491,2371,510,2071,124,3508,882,528,557,166,530,3135,1157,2271,1223,897,1153,1159,2001,804,1078,712,2087,2569,493,259,1230,2012,123,2976,1897,875,1988,1168,2967,3071,2536,1961,3276,1934,1096,2090,140,3529,701,2007,608,2372,2419,1935,2057,3123,3124,2908,3530,1933,2395,1173,921,2031,498,2080,2218,2956,1632,243,27,2943,2944,2385,2096,711,597,1079,2212,713,2470,64,825,2272,1836,1894,356,168,2017,2966,3001,1955,3228,2111,2011,117,3153,475,1063,2537,2460,2097,2013,174,2117,2508,126,1158,2983,2384,2452,2942,2464,2462,1900,2934,353,2110,1049,2591,2095,547,541,2382,360,2451,2461,2491,2260,761,1169,1896,1160,1941,2086,615,2450,1884,170,1957,716,2349,549,883,1164,1987,873,2454,2473,2482,83,2478,2947,2545,2936,390,3154,2228,2472,2381,3137,2204,2476,2348,29,2471,2990,3522,2477,2359,492,715,3259,130,2474,546,550,2006,2481,1090,389,1140,2534,2352,3083,2336,1227,1977,2098,1947,2383,1074,2109,2351,1162,3518,184,2345,537,3517,3516,2022,1878,839,2099,696,3521,1166,567,1971,2954,762,1928,3520,361,592,551,895,30,215,1145,2991,497,1954,1887,1052,129,1925,1141,2347,114,874,603,386,1889,1994,1150,2982,1655,1170,2444,544,478,1973,2912,159,248,881,2992,2033,1191,1178,1742,2446,1142,879,1137,1939,1058,1086,577,878,2153,2568,121,613,182,2909,2042,1740,561,2798,1245,169,187,2535,369,584,1920,3524,203,2118,2116,877,3136,385,2213,2571,1050,482,494,1073,1991,564,575,2014,2542,1081,1981,2005,3140,1993,1077,1048,1047,2946,1886,507,382,1840,2547,214,685,1151,2192,534,3263,1964,2378,542,1176,387,1930,3511,3096,499,3155,1082,1968,880,580,1083,1080,595,486,2771,525,366,286,2337,2008,1919,531,2338,2049,2533,3101,3509,1331,569,1266,1434,1966,1054,1950,503,535,368,365,667,1927,1115,364,2018,573,2391,545,2054,1902,570,2573,1228,2588,156,1852,2335,1433,2219,1007,2392,2055,3102,590,1929,3436,211,2156,481,616,466,3519,2918,2913,834,3079,2142,2009,485,694,1926,601,2694,1183,1912,191,2215,548,593,2279,1147,1983,585,2394,1969,495,231,1924,161,1103,3027,2563,2393,2346,574,1084,1890,1667,532,241,604,2445,856,2640,3532,1226,1906,860,533,160,625,2530,2380,1221,1586,526,2050,1959,1119,205,3449,2597,171,581,1222,2993,2782,2390,1144,2047,1065,2375,609,1750,1899,1148,1180,1970,610,552,358,2155,1892,1218,565,523,618,190,1952,372,1537,1967,1953,1055,483,78,1061,1749,790,233,1197,1972,2032,3526,2021,1051,538,1901,1579,200,872,1891,677,500,192,563,1072,1247,1706,828,587,2373,1881,1192,1182,2367,3512,2699,2051,891,668,1903,1568,2402,2088,636,1883,2386,1146,1070,2769,2977,519,919,591,1053,1177,501,502,1175,193,579,791,1685,3206,1066,1528,1189,1249,2056,3248,568,131,3002,742,2428,524,202,1904,505,1200,749,1187,583,1603,220,2387,558,70,2945,283,516,1805,589,1184,1895,1885,760,125,1712,1143,576,2429,1963,3125,607,2280,1190,571,2029,896,3108,2667,2799,2015,2355,2377,3513,479,2004,2374,680,1949,1683,1060,1976,871,678,3251,1152,2356,1505,1923,1589,204,1186,862,285,727,566,1535,1224,1708,273,1958,2541,2777,3510,1593,731,3205,2268,266,1596,1672,1085,1670,280,559,3190,1751,3207,1940,1946,3435,1219,2788,517,1609,511,374,1590,2582,1071,2458,438,271,1194,887,2388,885,870,1960,1677,3246,1659,480,2677,848,2193,733,2376,1234,2379,3188,2456,2000,1581,316,1986,1440,2453,1155,553,212,1691,308,1614,2459,2457,1990,572,560,586,2463,514,617,1754,330,476,763,3250,1196,1181,1606,1809,1611,1149,543,1598,1608,2417,884,622,739,1615,1605,1582,1587,1201,3523,1776,2580,2040,582,2793,2980,886,1999,1696,1962,1682,1944,1509,373,2023,1997,889,1982,867,276,2972,469,750,605,2046,363,477,1533,297,3242,588,2048,147,2596,226,1069,1998,294,1911,2143,2468,1937,1435,1943,1057,1532,3461,3199,1948,515,490,1936,822,2999,3254,2002,2034,3126,619,3202,2760,1992,2298,1974,183,2467,780,1796,295,594,303,556,384,3127,375,3243,406,1076,612,1932,201,1942,1595,536,1945,1707,1580,1995,2929,740,1513,2368,362,2364,1597,894,1592,2955,3198,1664,1665,1251,2666,888,2354,1922,2638,3186,1241,1907,272,144,746,301,488,2691,1179,1613,456,2509,238,1607,1588,1068,1067,504,1710,1610,1612,1938,1494,1075,2620,487,237,611,1931,279,496,1956,1591,529,12,1985,1989,3200,600,1594,1243,1242,1056,892,1250,1604,893,2581,3208,3209,3185,3204,1753,1695,3241,1481,3240,1745,3187,1661,518,1118,377,2365,1835,555,1965,1439,1551,1436,3417,2681,2366,458,2358,3183,2357,2353,508,1036,1546,2302,2283,2292,262,527,520,512,509,554,506,539,2019,1510
        // ]
        this.loadingModelList = []
        this.toLoadModelList = []
        this.loadedModelList = []

        this.loaded_mesh = {}

        this.loadlimit = 20
        this.loading = false
        this.httping = false
        this.pre_camera_position = new Vector3()

        this.mesText1 = document.createElement("p")
        document.body.appendChild(this.mesText1)
        this.mesText1.style.position = "fixed"
        this.mesText1.style.left = 20+"px"
        this.mesText1.style.top = 0+"px"
        this.mesText1.style.fontSize = window.innerHeight/60+"px"
        // this.op = 1
        window.server_ip = "http://47.103.21.207"
        if(window.projectName==="HaiNing"){
            window.server_ip += ":4010"
            this.id = 1
        }else if(window.projectName==="KaiLiNan"){
            window.server_ip += ":4011"
            this.id = 2
        }else if(window.projectName==="LanQiao"){
            window.server_ip += ":4012"
            this.id = 3
        }else if(window.projectName==="QinLaiLi"){
            window.server_ip += ":4013"
            this.id = 4
        }else if(window.projectName==="RenFuYiYuan"){
            window.server_ip += ":4014"
            this.id = 5
        }else if(window.projectName==="XinYu"){
            window.server_ip += ":4015"
            this.id = 6
        }else if(window.projectName==="YunXi"){
            window.server_ip += ":4016"
            this.id = 7
        }
        // 本地测试
        //window.server_ip = "http://100.65.113.54:3000"
        // if(window.param.projectName==='HaiNing'){
		// 	window.param.loadList = [
		// 		5510,5659,5660,5662,7116,5664,8646,5522,5514,5694,9059,8624,8632,5279,5208,5284,8204,5304,5315,8203,8628,5513,5272,8608,6950,5286,8645,5676,5519,5668,8626,5336,5511,5311,5282,8206,5523,8609,5516,5562,5726,5566,5283,5285,5667,8265,8268,8644,8625,8205,8631,5518,5302,5319,5314,8630,5669,8622,5563,5274,5524,8262,5567,3553,5725,6949,9298,8202,8629,5317,6947,5335,6951,411,3554,5515,8607,8269,5306,8163,9299,8201,8207,8623,6948,9297,8610,5303,5273,203,8200,5200,5661,8199,8267,209,5663,8603,5564,5666,8633,6945,5560,5313,8627,8261,5672,5561,5665,5693,5689,5197,5364,5217,5724,439,5305,8259,5565,462,5512,393,1357,5720,5520,5281,5722,5719,5670,8222,8611,9065,265,378,6946,5330,142,5824,9061,9300,8166,221,9296,8643,8604,956,5271,955,9414,8164,3196,467,214,249,3192,5365,5675,5671,8198,5277,3566,102,9254,5276,475,384,8264,95,5678,3555,5299,472,470,469,146,5316,474,2193,5318,9293,471,473,5691,468,101,5280,5721,133,14,227,3198,5196,5371,5688,389,3273,314,8263,9063,8260,140,5300,385,2172,639,5692,5214,5687,216,5297,1379,7048,5723,5099,381,1104,9057,5690,380,1659,5312,390,9415,97,9066,396,9228,9064,8965,3189,3181,5170,398,5673,292,236,513,419,9302,5124,5230,255,5270,9292,280,7061,132,418,9558,98,1248,5174,5221,400,413,9295,5233,3002,2067,220,256,388,637,9277,2455,5321,9255,5278,250,264,1488,2454,2815,1470,1465,171,5348,319,315,8635,2453,247,9294,1119,1528,6751,416,2663,5211,2059,2665,2062,2055,237,5650,1925,2227,2225,2221,2050,2259,3190,2452,5680,1904,1900,1010,2278,2223,5202,2451,2771,2765,1905,361,2739,970,2760,5485,9569,4943,2680,1499,1906,276,5289,2795,1462,3139,296,2019,2762,3271,5268,3174,266,2275,5465,5113,3199,966,373,206,603,253,7004,19,5201,629,5264,2830,7103,3176,9567,295,5320,1721,391,1318,4444,5437,320,2808,5215,318,2803,9170,5439,212,1467,2806,2757,395,1500,143,3158,1114,1654,7021,5260,4606,1429,3310,232,5253,910,99,1290,959,2357,9205,2679,5265,1328,4831,3194,5227,9229,5256,2783,5521,304,2607,360,738,259,3202,879,3278,8266,927,118,5251,5247,611,5228,1877,9171,2764,377,2280,5242,5220,9301,2065,5800,5234,312,5254,399,120,610,1159,2354,2742,3155,145,3210,940,2989,1118,2235,5259,5295,5252,5212,3203,3137,2456,2232,1527,2755,2789,908,2068,1513,2018,5249,3152,897,1750,2229,881,837,938,7296,917,5245,401,2445,915,3212,3179,941,1191,2697,901,270,2689,7029,1358,2254,5162,2664,2993,868,2990,2753,392,2216,231,5466,5267,1431,5219,1466,4989,5210,309,3159,2009,1660,1894,884,2690,2696,2457,1526,903,2290,3114,2430,2236,307,1036,3312,9183,2756,1497,9048,5255,5209,5623,871,2994,1461,2998,2273,922,5483,1917,2217,313,5232,5218,226,9187,3162,5248,410,3129,681,8216,2770,1891,9167,2222,2279,2246,355,1189,9204,3195,2328,352,5213,488,9191,317,7062,2329,2831,5238,150,928,5231,1898,5412,2816,672,8960,7005,5236,2458,5262,5243,1901,5257,606,522,595,9244,5225,715,5618,5261,9185,3165,271,2982,2582,2220,3741,1912,877,5865,2352,5240,1525,882,5610,9237,5409,3154,5207,2952,823,3216,9188,1501,1037,5454,3135,5205,9235,293,100,9256,7104,616,138,394,5595,1493,2348,2234,2272,5349,1492,4575,2282,604,5226,2274,5294,909,2336,2103,119,510,5239,2349,2692,916,2371,5119,690,5235,125,2338,2785,2382,275,659,1890,1261,1459,2447,2651,598,2370,2597,1911,2433,5224,5390,5505,379,1522,5266,8614,7112,3197,1893,2052,8223,257,144,933,2758,2598,7203,538,937,876,887,2072,2797,2048,1384,3150,9233,895,1056,9245,512,1106,9246,8854,2772,2779,2060,1468,5241,5263,5222,2450,5223,9260,1487,3211,351,3743,5246,9262,1504,2341,9263,946,2284,2634,931,3742,2652,2213,2380,2237,953,826,9207,5024,501,5449,1298,658,5598,6648,2735,5646,5619,5307,2769,2835,9234,9172,16,7063,5414,7360,3521,2595,5683,1498,2449,1903,9190,5328,5206,489,5237,873,934,5970,7022,5389,2788,949,5324,2291,2774,6864,5258,907,2578,2796,2688,2247,1915,769,1505,2017,857,2630,635,1652,2985,3113,1774,1693,515,406,2784,889,9184,7106,1064,5204,5596,9217,9196,5250,5593,5640,5644,2768,2292,5609,2807,573,892,5621,3130,683,2754,5377,2256,8742,1456,5504,5696,1489,357,1503,1460,2811,2345,269,1464,2025,2233,21,2351,3131,3134,5444,5509,2248,2214,5244,2265,2276,5506,2805,1458,1252,1409,1897,8154,2334,950,2219,5376,2267,2361,2331,2953,2822,2798,2829,5622,914,952,5637,5648,1294,36,5647,9213,9214,4393,9215,4396,9179,588,596,4423,9218,4545,2740,204,1190,9206,2344,2790,5415,967,2242,1895,2215,7105,1200,3167,1289,2832,3112,3138,1113,820,9203,9189,5397,3180,8642,865,2074,2271,905,900,878,2250,2240,2277,35,1715,9236,2269,5786,1502,272,948,2243,5329,904,2446,2044,2155,7113,920,886,550,2381,7026,5216,5386,944,274,562,9274,1471,9264,9272,2777,1918,79,59,15,80,60,94,891,693,924,923,911,734,2212,1524,7015,9211,5885,9555,7024,1495,403,8621,4563,1472
		// 	]
		// }
		// else if(window.param.projectName==='KaiLiNan'){
			// window.param.loadList = [
			// 	3465,2804,3547,2500,3475,3474,2504,2488,3548,3546,3576,2951,2839,2816,2949,2803,3533,2894,2892,3489,2795,3480,2543,2883,2882,2889,2957,3097,2812,2880,2809,2891,2888,2881,2810,2952,2884,2877,3476,2887,2875,2811,2893,2896,2874,2885,2873,2813,2396,2824,2113,2821,2814,2518,2863,2823,2870,2822,2871,2876,2963,730,2833,2895,2858,2818,2865,2515,2890,3550,2872,3551,2817,3485,2506,2878,2815,2886,2825,3560,2864,2806,2869,2519,2397,2827,2867,2807,3559,2829,3552,3557,3014,2499,2808,2828,2498,2842,2857,2879,3553,3555,2805,732,2819,2950,2849,2835,2830,2846,2856,2847,2861,2590,743,3132,2848,2862,2838,2841,2852,2520,2565,2860,2959,2834,2486,2832,2820,2487,2859,738,2868,2501,2866,3554,741,2826,2854,2505,2502,2964,2494,2503,3544,3537,2851,3055,3575,2489,2837,2844,2529,2831,3041,745,3498,728,2897,2576,3419,2855,3013,3541,2898,2850,3556,2107,2903,3539,744,2853,3026,2538,3134,3486,3028,2342,2905,2904,3086,729,826,2496,2845,2930,2962,1630,2484,3120,3133,2836,2958,2341,3572,2263,2843,2415,2340,2091,2447,2840,3534,2448,2900,726,3095,3098,3558,2544,2398,2411,3418,2115,2899,3087,3490,3497,3131,890,3569,3574,2522,2526,747,3432,3021,3477,1888,602,3500,3527,737,2492,2525,2416,3479,2524,3452,2801,2100,2521,724,3542,1979,3457,2045,3492,2932,3567,3088,2523,3535,2410,3112,2935,3487,725,2038,1174,734,3570,2449,3571,3488,748,2493,378,2264,3287,3481,3562,2259,2585,736,2497,173,2938,2258,3563,829,381,2924,2105,379,2427,2928,2262,3573,2441,2639,2907,695,2925,2941,2041,2917,2902,3090,197,2901,2037,2921,2249,380,3568,2995,2531,2495,2636,3460,2539,2796,2915,370,1642,3478,821,1651,770,2485,2587,3506,751,2561,2564,697,3122,2916,154,3012,3454,2787,2532,3504,2920,2278,2562,2216,3003,2558,803,2362,176,3005,3142,824,1195,2154,2559,2220,3549,2575,167,3042,2507,3459,2594,2084,1975,175,367,3499,181,2527,120,2083,3089,1980,2516,1231,25,1978,2579,2106,2148,2595,1232,2584,2339,1225,1220,2082,164,2276,2344,122,376,196,2572,3493,2797,2094,50,186,155,3540,2114,1774,2490,771,789,785,2510,596,3318,2430,194,2431,2434,3505,2433,2517,3528,2567,3536,2432,693,2914,2931,3011,2438,3141,2435,2412,1188,128,2437,2436,2102,2421,777,3006,2440,2439,2965,77,2939,1951,2092,2927,2413,2043,2414,2923,2401,2420,2422,2423,805,2081,2425,2424,2426,2036,700,2404,2994,2399,2406,3128,3129,178,3130,2400,2405,80,162,2407,2403,1167,2408,2409,2479,3545,773,3507,158,3491,1165,3496,1557,177,2101,3483,1199,2940,198,371,3443,1893,2369,2911,3147,2044,1163,3543,759,3482,735,3047,2291,3538,2261,2996,3068,606,3502,2343,3515,2786,1257,3503,3561,827,698,3121,1172,185,2305,188,107,3564,2112,2906,1898,180,2483,2455,127,2103,388,3073,2104,2465,752,3275,172,2802,2475,699,614,179,2469,2948,2480,2281,1161,2275,2574,3531,383,2968,521,2093,199,2010,2389,2035,2937,2443,2598,3015,2910,1905,2551,513,189,2418,2442,522,714,2089,3484,2528,3495,3143,876,2360,2070,911,1193,195,2085,106,2557,1138,3146,2152,3525,2269,1171,2513,3139,3494,3081,2108,2363,1185,163,115,3501,2922,2926,2668,484,3039,1154,1156,2975,2953,778,779,2578,786,148,2277,2792,157,2919,19,165,1229,1921,132,2361,2350,2566,2370,2560,2030,489,3060,1139,491,2371,510,2071,124,3508,882,528,557,166,530,3135,1157,2271,1223,897,1153,1159,2001,804,1078,712,2087,2569,493,259,1230,2012,123,2976,1897,875,1988,1168,2967,3071,2536,1961,3276,1934,1096,2090,140,3529,701,2007,608,2372,2419,1935,2057,3123,3124,2908,3530,1933,2395,1173,921,2031,498,2080,2218,2956,1632,243,27,2943,2944,2385,2096,711,597,1079,2212,713,2470,64,825,2272,1836,1894,356,168,2017,2966,3001,1955,3228,2111,2011,117,3153,475,1063,2537,2460,2097,2013,174,2117,2508,126,1158,2983,2384,2452,2942,2464,2462,1900,2934,353,2110,1049,2591,2095,547,541,2382,360,2451,2461,2491,2260,761,1169,1896,1160,1941,2086,615,2450,1884,170,1957,716,2349,549,883,1164,1987,873,2454,2473,2482,83,2478,2947,2545,2936,390,3154,2228,2472,2381,3137,2204,2476,2348,29,2471,2990,3522,2477,2359,492,715,3259,130,2474,546,550,2006,2481,1090,389,1140,2534,2352,3083,2336,1227,1977,2098,1947,2383,1074,2109,2351,1162,3518,184,2345,537,3517,3516,2022,1878,839,2099,696,3521,1166,567,1971,2954,762,1928,3520,361,592,551,895,30,215,1145,2991,497,1954,1887,1052,129,1925,1141,2347,114,874,603,386,1889,1994,1150,2982,1655,1170,2444,544,478,1973,2912,159,248,881,2992,2033,1191,1178,1742,2446,1142,879,1137,1939,1058,1086,577,878,2153,2568,121,613,182,2909,2042,1740,561,2798,1245,169,187,2535,369,584,1920,3524,203,2118,2116,877,3136,385,2213,2571,1050,482,494,1073,1991,564,575,2014,2542,1081,1981,2005,3140,1993,1077,1048,1047,2946,1886,507,382,1840,2547,214,685,1151,2192,534,3263,1964,2378,542,1176,387,1930,3511,3096,499,3155,1082,1968,880,580,1083,1080,595,486,2771,525,366,286,2337,2008,1919,531,2338,2049,2533,3101,3509,1331,569,1266,1434,1966,1054,1950,503,535,368,365,667,1927,1115,364,2018,573,2391,545,2054,1902,570,2573,1228,2588,156,1852,2335,1433,2219,1007,2392,2055,3102,590,1929,3436,211,2156,481,616,466,3519,2918,2913,834,3079,2142,2009,485,694,1926,601,2694,1183,1912,191,2215,548,593,2279,1147,1983,585,2394,1969,495,231,1924,161,1103,3027,2563,2393,2346,574,1084,1890,1667,532,241,604,2445,856,2640,3532,1226,1906,860,533,160,625,2530,2380,1221,1586,526,2050,1959,1119,205,3449,2597,171,581,1222,2993,2782,2390,1144,2047,1065,2375,609,1750,1899,1148,1180,1970,610,552,358,2155,1892,1218,565,523,618,190,1952,372,1537,1967,1953,1055,483,78,1061,1749,790,233,1197,1972,2032,3526,2021,1051,538,1901,1579,200,872,1891,677,500,192,563,1072,1247,1706,828,587,2373,1881,1192,1182,2367,3512,2699,2051,891,668,1903,1568,2402,2088,636,1883,2386,1146,1070,2769,2977,519,919,591,1053,1177,501,502,1175,193,579,791,1685,3206,1066,1528,1189,1249,2056,3248,568,131,3002,742,2428,524,202,1904,505,1200,749,1187,583,1603,220,2387,558,70,2945,283,516,1805,589,1184,1895,1885,760,125,1712,1143,576,2429,1963,3125,607,2280,1190,571,2029,896,3108,2667,2799,2015,2355,2377,3513,479,2004,2374,680,1949,1683,1060,1976,871,678,3251,1152,2356,1505,1923,1589,204,1186,862,285,727,566,1535,1224,1708,273,1958,2541,2777,3510,1593,731,3205,2268,266,1596,1672,1085,1670,280,559,3190,1751,3207,1940,1946,3435,1219,2788,517,1609,511,374,1590,2582,1071,2458,438,271,1194,887,2388,885,870,1960,1677,3246,1659,480,2677,848,2193,733,2376,1234,2379,3188,2456,2000,1581,316,1986,1440,2453,1155,553,212,1691,308,1614,2459,2457,1990,572,560,586,2463,514,617,1754,330,476,763,3250,1196,1181,1606,1809,1611,1149,543,1598,1608,2417,884,622,739,1615,1605,1582,1587,1201,3523,1776,2580,2040,582,2793,2980,886,1999,1696,1962,1682,1944,1509,373,2023,1997,889,1982,867,276,2972,469,750,605,2046,363,477,1533,297,3242,588,2048,147,2596,226,1069,1998,294,1911,2143,2468,1937,1435,1943,1057,1532,3461,3199,1948,515,490,1936,822,2999,3254,2002,2034,3126,619,3202,2760,1992,2298,1974,183,2467,780,1796,295,594,303,556,384,3127,375,3243,406,1076,612,1932,201,1942,1595,536,1945,1707,1580,1995,2929,740,1513,2368,362,2364,1597,894,1592,2955,3198,1664,1665,1251,2666,888,2354,1922,2638,3186,1241,1907,272,144,746,301,488,2691,1179,1613,456,2509,238,1607,1588,1068,1067,504,1710,1610,1612,1938,1494,1075,2620,487,237,611,1931,279,496,1956,1591,529,12,1985,1989,3200,600,1594,1243,1242,1056,892,1250,1604,893,2581,3208,3209,3185,3204,1753,1695,3241,1481,3240,1745,3187,1661,518,1118,377,2365,1835,555,1965,1439,1551,1436,3417,2681,2366,458,2358,3183,2357,2353,508,1036,1546,2302,2283,2292,262,527,520,512,509,554,506,539,2019,1510
			// ]
		// }
		// else if(window.param.projectName==='LanQiao'){
		// 	window.param.loadList = [
		// 		5301,5300,5322,5346,5374,6543,5281,5304,5383,5381,5379,5361,5326,5356,5305,5277,5324,5388,5310,5302,5102,5104,5274,5103,5357,5375,5101,5303,5280,5384,5320,5351,5120,5119,5115,5364,5380,5118,5385,5117,5116,5370,5311,5321,5244,5386,5328,5369,5387,5163,5105,5109,5337,5355,5348,5242,5377,5292,5251,5096,5110,5285,5366,5382,5413,5309,5344,5286,5317,5358,5378,5108,5264,5338,5306,5097,5360,5248,5094,5111,5343,5276,5325,5263,5132,5107,5368,5308,5265,5294,5318,5164,5593,2,5365,5266,5092,5091,5090,5438,5133,5089,5106,5307,5246,5088,5275,5293,5087,5297,5095,5327,5262,5371,5154,5134,5249,5200,5093,5412,5257,5114,5247,5350,5367,5083,5082,5584,5630,5152,5131,5319,5261,5272,5098,5316,5359,5278,5253,5555,5199,5143,5252,5165,5329,5372,5100,5255,5336,5081,5254,5153,5241,5130,5553,5129,5587,5080,5330,5332,5157,5158,5403,5140,5145,5450,5159,5646,5149,5155,5260,5404,5271,5142,5315,5144,5147,5156,5151,5148,5258,5150,5269,5259,5099,4,5141,6033,5146,6755,5160,5709,5273,5586,5314,6028,5245,5363,6072,6473,7,4930,5136,5250,6790,5376,5649,5920,5113,5585,5440,4209,5135,5631,6785,5411,4660,5420,5267,5349,5443,905,989,3425,5426,5761,5588,4926,246,903,5112,1218,5347,6101,993,5595,3939,5591,5445,5268,3476,5076,277,3899,997,5828,6689,5333,5922,6792,5804,5415,4917,5162,1283,5342,5482,4912,4914,5647,6787,1514,10,2947,4341,5439,984,5745,4262,3971,5078,1755,5086,6786,21,11,3970,3915,5490,994,5446,5414,6031,3911,5452,5270,5427,5296,4931,2921,6538,5554,4947,6474,6,3912,4916,967,5331,3427,3331,3428,4910,5488,3897,6791,1160,1054,3944,5672,9,3332,382,4909,5295,5753,2933,6668,4218,3940,5772,5763,3941,844,1779,6102,3937,5182,973,3936,4609,784,980,987,3905,5407,6477,5648,1217,985,6789,4915,970,992,6783,3943,6557,5807,5652,547,3938,869,5225,3942,3966,3959,1052,6762,4922,746,6462,1055,4344,1003,6082,1062,3426,3951,1791,4401,3430,4219,3120,1170,3958,3916,6562,725,5625,3964,6650,8,3424,3969,6761,983,5161,5373,5783,5256,1059,5,5762,5751,5820,6788,5744,1778,1001,146,5549,976,5594,3343,6461,4217,979,5562,4198,43,3973,3869,1037,3902,4208,6457,4606,5431,5694,1033,3210,3982,3904,3952,2461,3898,3910,6077,5752,4726,3949,3932,3931,3906,3947,3950,3329,3429,5823,6498,2946,4607,205,3963,3955,3980,5754,6098,1050,5773,767,4928,853,6491,3121,48,3117,3930,6034,3926,3967,1941,5224,5183,816,817,990,3418,5619,5609,904,3849,3934,3419,3913,6757,6458,6493,5552,721,1204,6478,3834,3968,5927,3867,3470,3945,6780,5743,5731,872,3914,4224,37,3213,6495,1805,3974,6459,1802,1188,4929,1623,1756,6087,6649,6065,599,4901,5607,3975,3933,5928,5435,742,2503,867,1125,250,3962,3835,3965,741,229,5756,5747,5746,3836,5757,3868,5755,818,5395,6688,3212,849,5758,6277,5999,1614,6086,5770,789,815,3856,3946,0,3948,3960,1154,5287,5759,3119,4210,5430,775
		// 	]
		// }
		// else if(window.param.projectName==='QinLaiLi'){
		// 	window.param.loadList = [
		// 		4081,3096,4082,3260,3257,3426,3575,4084,3101,3093,3562,3100,3212,3214,3200,3647,3259,3579,3262,3648,3269,3211,3266,3756,3571,3565,3099,4083,3106,3567,4181,3194,3577,3646,3103,3264,3219,3267,3425,3270,3098,3569,4078,3094,4180,3573,3578,4079,3105,4080,3765,3203,4210,4227,3256,3268,4213,3595,3197,3265,3095,3205,3196,3768,3793,3563,4182,3213,3583,3104,3263,3587,3764,3220,3250,3272,3245,3207,3572,4147,3216,3258,4228,3335,4211,3202,3759,3762,3102,3198,4214,3215,3246,3247,4197,3217,3580,3193,4205,4224,3371,4220,3201,3249,3210,3394,3514,4206,3770,3271,3317,3209,4215,3223,3375,3234,3218,3208,4207,3761,4235,3248,3195,3253,3232,3237,3391,3204,3760,4107,4202,4200,4179,3576,4146,3566,3590,3254,3552,3767,3225,3255,3402,4006,4216,3568,3224,3108,4225,505,4004,3546,3387,3227,4203,4132,3588,4217,3574,3222,4218,3241,3172,3558,3559,4229,3097,3906,3620,3841,3388,4036,3109,3845,3221,3392,3769,3564,3584,4008,4035,3404,3126,3645,4005,3124,3380,3116,3128,3226,3766,3125,3383,3390,3888,3112,3794,3622,4177,3117,3316,3396,3532,3774,3621,4095,4209,3544,3581,4221,3242,3160,4145,3840,3239,3111,3763,1448,404,4208,4109,506,3585,3642,3386,3244,3847,3748,3547,3159,4204,4144,4130,3395,3389,3873,4196,1190,3538,3914,3800,4097,4184,2746,3199,3233,4148,3905,3189,3385,4128,3586,3773,3775,3382,4201,3592,3252,3359,3593,3190,1438,1296,3366,3110,3379,4110,3771,3397,3363,3174,3850,3261,3851,3163,3206,3555,3177,3179,1320,3553,3887,1436,3176,3842,2752,2606,4194,3171,3178,4113,3594,1310,3400,3844,3377,4106,3854,3175,3360,3122,3913,3384,4116,4112,3120,1455,3161,3235,3170,463,4117,2690,3127,3119,3158,4103,3551,3157,4007,3570,3191,3852,3155,3747,3849,4234,3853,3772,3836,3121,1450,3589,3156,3582,4236,3185,2498,3940,3162,3251,3370,3240,3524,2439,1304,3374,3554,3367,3136,1440,2609,1303,1308,3405,498,1191,3368,3148,3236,2472,3513,3846,4099,3153,4123,3901,1453,3118,3855,4012,3365,3166,1349,1443,1293,4111,1306,3643,2598,4129,3915,3856,2745,3848,1445,2501,3880,1452,1298,2564,2446,3361,2594,3180,3799,1301,1425,3912,3147,1437,3614,1088,587,1447,3399,3152,3173,3843,3857,4232,1302,4131,4198,3445,1307,4100,1300,530,544,1203,4101,464,2689,1444,1442,4089,4105,4237,510,1446,4104,4226,1449,1299,3943,3542,3623,3997,3151,3644,1292,3376,508,4085,3909,4096,3613,3591,4040,1159,4009,4118,4026,3115,4193,1806,4102,4125,3976,3977,3911,491,3358,1151,619,454,574,556,3450,4199,3978,3876,4231,3904,923,2608,4122,3393,462,4233,1311,3398,3362,3916,3863,726,830,3556,4212,3596,4039,339,406,4121,4119,1451,3,2585,4115,513,559,461,3150,2750,832,1227,721,3183,1439,2607,692,548,895,3902,3605,2561,2445,3181,1808,3958,691,3238,437,1259,2692,4126,215,1577,4230,4098,465,2519,567,467,1441,536,4140,702,2457,3184,3535,487,3182,1454,1297,696,1809,503,1431,613,582,2751,500,1153,2499,3758,3478,459,3149,693,4120,580,2713,4046,3609,522,4027,599,3979,3228,3138,4013,210,2597,620,4034,2595,2610,130,1802,501,1576,1213,1158,514,1295,2580,4037,1193,480,688,466,421,1177,718,1309,212,707,528,3530,2447,524,2708,610,4028,3154,507,626,1433,572,486,1434,413,525,699,150,698,2395,1220,2411,547,669,617,2749,1305,690,602,3628,3137,440,256,4222,624,543,482,633,579,504,614,2456,502,569,411,132,719,2744,4048,494,589,2505,1200,694,4219,3187,424,418,725,419,511,720,124,2691,451,512,3192,469,2392,478,148,674,634,597,493,479,625,644,716,416,138,455,3113,1270,730,497,709,526,650,562,622,560,3996,689,415,518,557,492,700,546,523,19,2412,488,1369,564,549,635,1205,3526,695,4041,655,538,1561,1827,4137,442,444,4134,729,3543,3750,297,646,561,563,4114,537,484,573,485,570,3381,521,2490,675,554,550,475,722,603,495,476,583,509,446,450,4141,429,1195,2686,732,568,727,533,490,598,553,607,438,496,552,724,639,439,566,517,2518,535,516,1578,519,414,595,343,697,685,1277,426,600,576,3372,1224,714,682,616,2504,412,581,2590,645,723,474,638,612,2693,2491,4139,483,1580,586,422,733,2489,453,596,477,705,542,3403,609,558,606,731,584,423,1816,3123,2512,551,728,230,441,628,618,149,532,238,472,658,468,425,1212,649,433,435,489,715,704,499,615
		// 	]
		// }
		// else if(window.param.projectName==='RenFuYiYuan'){
		// 	window.param.loadList = [
		// 		2438,2634,3216,2383,3291,2706,2374,2380,3214,3212,2658,2699,2378,7277,3211,3316,3311,6750,7272,3196,6712,2371,2705,3205,2439,2704,2694,6714,2381,3198,2703,6724,2700,3278,3210,2677,2664,6707,3276,3285,3319,6720,6728,6726,3309,2690,9111,2673,6717,6742,2452,3273,3199,3219,3290,2691,3220,2388,3275,3310,3209,3206,2689,2697,3279,6754,2440,9474,3267,3326,3258,11031,2675,3262,2397,3270,6727,6710,6741,6749,3299,6716,6753,3286,6722,3227,6708,3292,3322,3217,3204,2376,2648,3261,2661,6718,3221,6774,2639,3351,2657,2649,2459,2659,3260,7739,6614,2637,6611,7396,3342,2662,2451,3264,2696,2450,2392,2656,2654,9029,6766,8028,3337,3263,6760,2668,3272,2530,3265,2655,3343,2393,2382,9313,6737,3338,2667,2372,3208,2653,7676,3271,3203,3218,3350,6721,2384,2665,2499,3303,3317,3349,3345,3223,9221,3344,3353,3294,6730,3354,6135,6723,2463,2741,2707,6725,7825,2441,2966,3339,2449,6744,9404,2533,3348,3259,3269,7276,2638,3194,2541,2387,2652,2636,7992,2666,5915,2684,2679,2373,7278,2678,2457,2442,3242,2683,7271,3266,3312,3207,3293,3200,3215,3300,2692,2379,9262,9264,7273,9261,6729,2228,9260,2640,2643,11284,2686,6713,3318,2681,2680,3268,3324,2377,1165,2685,2883,6765,7996,6719,6743,9259,2453,3355,3314,2701,2693,2375,2391,2698,2973,11282,8119,3329,6736,7827,599,3302,3352,2682,2641,2891,2448,6740,9263,1619,2385,3304,3323,9312,1851,2399,2186,2405,2726,6711,11035,2538,6759,3313,7745,8039,2080,3301,3328,9413,7799,9308,6739,7856,3327,2892,3202,6610,2487,7461,7993,7801,5914,11281,3280,2152,3201,2904,2644,3224,2854,7413,2185,2394,9406,2464,7797,7355,7412,6764,2386,9122,6735,6734,864,2370,2695,6756,7907,726,7969,9352,6757,7415,9288,600,2467,9425,11080,1159,6763,3321,2489,7414,8065,9258,6733,3320,7968,3246,6773,6775,2663,3289,9541,9428,8170,952,7998,2472,9251,3336,7858,6715,2114,1839,9247,2488,2645,7857,9222,2395,6694,6762,2660,7824,11089,7245,2905,3325,137,3284,9157,1848,3287,1695,9232,2437,9323,2688,1706,9273,6772,2539,2402,9465,2075,7230,3277,3225,8017,1976,8027,9412,3234,9351,2535,1052,7810,9418,8018,7447,5904,2025,8010,786,7720,7426,2153,7861,9409,11041,3307,9229,688,7796,11098,3222,9225,965,3340,827,1441,9408,2702,2232,2077,9422,1825,2687,8007,783,3197,3213,11283,913,8130,2999,7186,2411,2497,7246,7431,9350,9190,10992,2475,2409,2642,7231,9257,2858,791,8035,9407,6888,9226,2407,9228,2492,7727,9224,1694,3288,2496,1019,2997,6768,784,3297,8135,9414,7211,3023,797,3195,9266,7381,136,2867,3335,9348,2420,1718,11105,7364,8139,6698,2123,9417,9349,6699,7966,7243,9532,781,9184,9438,9315,6815,3306,9423,8738,7430,7160,7168,162,2479,9433,2981,9520,9249,2909,10999,7855,2889,3315,11040,9397,11180,11072,9359,11218,9343,11073,7425,2895,2972,6751,9307,9508,9355,1714,9123,8142,7999,8004,9454,9531,7207,9365,163,6816,950,7460,2823,3233,2174,2419,7178,7208,9117,7214,7212,9008,8709,9453,7177,7167,9430,7210,7213,7176,7802,7209,7222,7216,9518,770,7218,8976,7221,8986,9286,7191,2494,9399,3281,3330,9243,11166,11115,9011,7800,9328,9394,9530,6656,1164,11140,2503,9456,1829,2358,8199,7432,803,798,9442,7803,11070,9411,9271,2147,8077,790,2156,2877,1,1977,9497,9023,9325,6624,7260,9373,11077,8169,8998,6709,2671,2414,7410,9019,692,698,9040,6655,9012,9005,1552,8983,9020,6657,9037,9026,9236,9071,9390,9400,9045,2108,9549,2893,56,9032,6612,9336,9362,1041,9253,7161,1699,9220,9250,11033,801,2670,1435,9318,7166,7162,7180,9551,9429,7170,11139,2180,9361,3226,712,8000,3093,8965,9344,9285,3024,9369,2465,9068,9017,7728,2564,8980,9396,7139,3295,1396,6650,9006,9248,9382,6619,2518,768,1720,6620,9354,2635,8078,7442,3283,11085,3244,6649,9255,2911,9347,9002,8767,3027,9048,2825,11171,8021,11076,8979,793,7795,8968,3308,11141,9314,9381,9030,11146,9427,2505,2166,9231,7997,7967,1973,11143,3347,9060,9401,7991,3296,6651,1152,6648,9292,8032,8227,6660,9241,9434,7141,9521,7179,9402,9550,9024,8807,6654,9265,11155,8973,11107,9327,9013,8994,7459,9051,9416,9460,9458,2872,1006,3282,9372,7142,9515,714,9059,9118,8626,2975,7172,787,2401,8076,2117,690,159,7740,9001,9367,2398,1160,7035,7041,7069,7075,7081,7086,7114,7120,9056,11168,7738,2995,6623,6661,3058,2894,2912,6628,9256,11083,2907,6813,9410,6658,7029,9522,7131,7126,5902,6996,7046,6827,11154,7052,7058,2888,7445,854,6629,6639,7108,8166,8064,7092,2906,7136,7165,808,7001,7103,9333,2328,7023,409,2113,1974,6796,6627,9310,7269,7098,1558,7781,9022,7832,9371,9392,9444,3026,771,7446,8989,11157,6845,6821,11179,8165,1047,8997,7018,7007,382,9419,7104,7965,9057,2992,6797,3245,9424,2852,6826,789,6640,9386,2507,6822,7097,7680,2728,6846,8012,7951,9042,6839,9464,6840,11321,6841,6842,6843,6844,8134,9237,9268,6847,7924,6848,6849,6850,7183,11075,11101,6851,6852,6853,6854,410,381,6625,9053,9435,9067,9043,8987,1199,7091,383,6589,3298,7223,6574,9014,7109,6565,6552,6551,6777,6779,8972,6782,6786,6787,6788,6790,11209,7013,1685,6793,9080,7716,6798,6799,6800,414,6801,6802,6803,6804,6805,6806,406,6808,6809,6810,6838,6811,6837,2913,9142,6823,6824,6825,6836,7181,6835,6828,6829,6830,6831,6832,6833,6834,9379,942,3016,1562,7331,2122,3092,868,1324,2055,9415,7019,7115,8999,8992,9459,9290,7772,8990,408,11173,2916,7012,6641,8051,407,9539,9062,11102,9234,7972,9274,11090,7979,2182,6577,7138,3274,7159,6778,9058,7006,11219,9077,8970,59,1356,8985,9334,1780,2927,9100,1972,11163,3334,9015,2148,1395,2778,11175,2914,11112,9086,11092,1312,9534,11069,9403,11174,1513,763,7024,9115,2461,7804,8977,7121,6597,11106,6795,7137,8975,9003,9066,2772,7085,1844,9227,2119,1725,1728,9358,11114,6807,6794,7030,11071,6792,6791,6789,6785,6784,6783,6781,6780,9537,7950,11147,8539,1845,11078,380,9114,7670,8969,6634,2898,7948,9018,9272,2882,9326,11091,9320,7769,11211,9034,6633,6566,7237,2149,11161,8984,9039,9507,2403,8006,11137,7274,7080,6576,8991,9065,9337,2416,6638,8016,11082,11084,9041,6591,11178,857,1161,9095,769,6603,9036,11182,9035,9009,802,2752,11148,7036,9070,11181,11149,8577,63,9074,8174,9360,11142,2404,11109,11099,9376,8003,8168,7900,7074,1132,1536,2504,2876,2155,2126,1776,11111,378,9277,11110,9476,11087,871,8966,9356,3022,9027,1626,8993,6951,8996,2861,6635,9506,2793,7330,9097,8964,9033,11213,8013,2783,11215,2513,2646,7462,11113,11177,9512,6956,1698,10990,2998,11185,6646,7456,6592,9047,7188,9016,72,9054,9073,1750,1236,785,11097,1560,7964
		// 	]
		// }
		// else if(window.param.projectName==='XinYu'){
		// 	window.param.loadList = [
		// 		133,7,126,0,144,322,136,6,3403,2,134,14,135,130,3404,311,321,304,5,306,3405,3288,348,5238,5239,2216,4,199,9,3285,13,11,145,345,2696,320,138,347,1977,132,2014,3,257,1974,269,327,328,344,256,5081,247,159,246,12,160,137,161,3282,283,110,235,8,272,243,140,323,5151,258,349,30,131,1985,324,3271,234,259,248,245,154,396,299,139,263,300,295,290,326,270,298,241,236,301,293,162,202,3280,5191,221,127,128,196,10,152,239,15,249,4433,189,124,244,593,1,146,156,284,252,312,5078,3270,157,153,253,280,223,3281,207,275,296,3276,200,3275,2627,5341,18,63,55,5202,1359,203,5083,303,206,309,20,3105,273,3290,310,285,264,255,220,4364,313,271,265,150,242,314,2685,4438,281,5153,35,179,308,129,240,5093,170,185,5338,60,149,294,4363,307,107,59,3260,190,186,68,343,429,2619,2609,2607,1987,530,67,2648,2621,2498,2637,2639,2567,3261,2590,5067,2663,2657,2565,336,2646,42,2655,2507,2588,2491,2665,2490,2584,62,2586,5224,520,2534,2552,2561,2671,2508,5222,2517,1276,2643,2677,4303,2679,2543,2652,5152,3279,3263,2544,2672,2499,254,2535,2563,66,4325,210,2404,5073,2553,488,5154,4299,2516,2493,2526,2510,171,2501,262,2581,225,5226,47,2659,2569,3303,2578,194,2525,2312,4294,2667,204,2592,2555,2017,562,2601,2604,2673,2675,2681,2537,261,3500,169,3120,4297,2519,1715,108,3133,2546,222,215,282,205,2528,4306,2613,2625,209,208,2935,3107,4315,5339,1989,354,99,3269,409,351,21,58,2053,3490,2608,38,3264,2620,165,97,2647,142,2606,346,147,2636,109,65,2638,325,2200,3297,2589,2645,2664,49,2662,3436,350,2656,2492,48,2587,2551,2583,5072,2562,2560,2564,2566,4362,2217,2676,5243,4314,2524,4317,2533,2654,268,2585,2515,5221,2618,2406,2554,2536,4316,2506,2678,5223,4521,2542,2489,155,330,2411,2518,5213,2405,2616,193,39,4302,4434,158,2545,3278,316,41,292,2509,4313,2410,2527,337,2016,297,250,329,2629,2628,1346,3266,143,318,5077,2398,4309,2403,52,2572,3262,4085,485,4305,3258,483,484,1129,4300,481,460,1692,2574,1690,227,177,480,5065,2397,1687,459,167,1686,482,4411,486,5336,100,2595,305,1125,1126,5242,4310,1684,1681,1275,1788,1697,1142,1759,457,453,381,2463,451,1699,340,1676,1696,226,4320,1698,1762,4089,1689,4097,1128,2412,1688,1272,2488,1701,4324,1012,1146,1768,1769,4323,1802,1123,2521,1700,478,454,4101,452,2500,1772,1149,2633,2407,509,455,4103,4307,1966,1771,1137,2666,4091,1800,1679,1804,1674,4102,368,2603,1015,4094,276,40,4099,989,476,3272,1693,4321,1664,595,1277,1758,2658,1761,1955,1795,1278,762,1801,4319,4410,1274,1271,2548,991,1793,2330,1766,1764,462,1969,1964,302,1790,1786,1695,1694,2313,479,4106,1685,4090,4087,1141,875,3274,1017,1131,172,997,1672,1002,1159,1564,773,1267,1799,759,1459,1957,587,1763,1760,1001,1683,998,1154,1521,1667,1522,1666,1463,1465,1691,1270,1963,1791,1797,1147,1773,1143,1006,2632,590,1798,1266,1140,465,591,1770,988,1669,2568,1127,5075,753,847,751,1970,994,995,54,1152,1975,1967,492,1122,760,1158,141,1678,4322,1124,1132,1133,1467,986,1136,754,1138,456,1792,3310,1794,3273,1273,1776,1956,458,3316,2624,331,1673,2600,869,195,3313,999,332,466,992,4088,2591,985,4100,756,2642,1145,5023,1144,1780,1134,1777,477,1019,1021,3354,1286,996,2945,1135,861,2631,1952,2401,2326,2612,2400,5228,1460,2683,848,866,1968,2577,768,4308,843,1703,1779,750,873,1787,3257,877,461,3321,878,849,1269,846,3277,584,585,588,56,1011,2512,2329,1961,1774,880,1765,2617,844,597,1850,1014,594,1671,842,1160,1130,2502,277,1000,1783,990,1775,1464,474,366,472,757,3840,987,148,473,3284,2409,2623,1157,2651,4312,1767,879,2323,168,3585,463,1965,1962,1018,1782,1519,4248,4261,4249,1796,3804,862,1517,3727,4263,1453,4250,4251,4254,3803,4255,3786,3726,4256,4180,1458,4264,3924,4265,1785,3798,3724,4266,874,3933,3923,4260,3932,3931,4179,3930,3922,770,3849,3802,3842,3839,3801,3660,4259,3928,4035,3927,3926,4041,4258,867,4092,3659,3657,4190,4086,3656,2641,1358,3318,3319,3320,3355,3356,151,3858,3787,4104,1139,3511,3799,4178,4098,4096,3312,3357,3364,1954,3372,3376,1958,1959,3314,3315,3655,3527,4003,3350,3351,3455,3456,3458,5316,3459,3460,3461,3352,3602,3363,765,3371,3375,3603,4177,3662,3663,3446,3447,4172,3450,2576,3451,3664,3453,3512,3665,3667,3668,3669,3654,3670,3593,3592,3728,3731,752,3588,3590,4175,4174,3733,3734,4173,3735,3591,3796,3797,338,2487,1005,845,4253,1003,2485,1282,5337,592,586,93,192,1682,1151,1803,1670,1668,1971,1461,1009,755,4028,3552,871,851,1514,470,4105,855,863,776,857,3970,860,3853,3349,859,3448,4093,3520,2547,3587,3725,3996,3586,3989,450,1953,4084,3525,763,3489,1468,1470,1471,3259,53,1452,4189,865,868,1778,872,596,1784,749,1457,1010,2529
		// 	]
		// }
		// else if(window.param.projectName==='YunXi'){
		// 	window.param.loadList = [
		// 		5000,4695,4732,4853,4855,5300,5304,5220,4700,5225,5290,4692,5344,5222,4851,5343,5341,4860,5342,5328,5332,5325,5329,5291,5226,5324,5306,5334,5331,4737,4738,4861,4733,5330,4852,4830,5001,5340,4829,5307,5337,5322,5400,5333,5311,5303,5338,5292,5327,5336,5321,4697,5301,5283,5310,5296,5335,4827,20,5326,4696,5223,5323,5295,5317,5320,5305,5318,5289,4698,5287,4854,5224,38,5280,5285,4992,5398,25,5276,5316,5277,5297,4734,5284,5294,5299,18,3125,5308,5007,261,5008,5281,2,22,4832,5319,204,56,5402,5313,5293,5298,5399,36,3206,4833,23,3018,5314,5312,1,5404,0,5279,63,3347,21,2111,4987,4,5339,7,24,4905,130,3082,4691,55,2039,1616,3333,43,5221,5347,129,41,1381,563,2990,114,3183,48,3213,3197,3111,5,3126,49,2135,64,39,50,51,4699,33,5282,3243,35,62,16,3287,2136,3238,4091,3241,19,3728,5278,5396,10,30,61,2157,1777,205,42,5286,5217,5009,15,3390,2151,1216,1558,1219,3124,3182,1576,3363,17,752,589,3108,3106,122,1573,3369,1575,1622,1568,1570,754,26,6,917,1621,1569,4826,1769,653,1572,3292,1571,1574,624,1581,860,3271,3291,1566,11,3368,5288,2048,4991,1583,1585,1565,669,3009,1562,1559,627,1701,125,3373,3239,3028,699,1705,3370,3105,2981,571,2083,821,34,1706,3354,569,1584,2084,512,4999,1222,610,587,1567,120,1626,3209,574,131,3129,1707,663,2661,606,40,1625,1563,849,607,2071,270,1589,1579,60,1564,1588,808,1587,3014,12,3113,119,1586,2110,3233,3362,3391,612,501,882,1251,661,1582,37,126,590,739,906,460,5403,3207,59,65,566,3156,1561,46,702,664,1580,3335,605,105,3025,3352,3348,665,3211,1578,3,568,1590,854,47,558,1615,885,740,942,1768,2112,3346,651,57,3223,868,1230,3483,807,862,1554,1248,3010,756,711,1658,3000,820,1704,684,937,683,2148,797,3221,1620,616,871,2070,830,14,771,2716,801,1624,2082,943,124,360,5346,609,116,1436,3361,266,1226,356,928,783,899,1110,700,1991,603,1778,4914,905,4730,926,1246,581,618,117,833,1245,1199,1631,737,929,903,694,572,570,721,588,814,895,880,3002,1231,4094,3224,930,1698,635,421,719,772,2132,897,637,1227,1229,824,1250,3212,559,3181,755,1994,2069,838,52,1613,626,884,650,3117,636,2620,778,1995,811,54,1215,870,751,823,2728,1247,3027,1232,1126,45,622,883,1218,3342,1952,565,3349,491,29,753,1703,3123,918,787,1238,1228,1982,562,3118,828,113,671,573,3122,749,847,1990,1623,785,1243,3110,660,723,264,696,3107,3008,817,933,53,13,1217,743,728,611,8,679,604,773,2072,790,1437,3210,662,4092,5390,745,914,1224,1172,591,1149,815,3033,599,1161,3226,672,3215,1148,2158,698,1614,575,856,1560,413,1619,896,705,1987,1101,863,701,784,4277,3185,66,795,3242,1175,127,3227,217,901,1632,3112,652,5309,1235,115,712,910,27,3336,3240,3078,561,577,3236,855,3376,1628,775,794,1107,717,619,2067,720,2980,869,846,265,858,316,521,2797,1630,934,829,750,2051,506,1109,578,3235,3021,1244,428,3083,3372,608,798,1700,576,2924,3245,567,1195,3231,827,777,1237,323,74,1064,3019,1959,3230,437,3293,2995,44,2942,1173,725,2152,655,3288,1949,1239,3029,3155,3272,1946,584,722,873,713,3290,748,3286,579,118,1067,9,3234,813,786,3237,560,3225,922,741,724,697,1225,799,583,3367,2149,2043,2046,680,2721,3355,864,2109,615,774,1780,676,681,2791,2934,2038,1699,3001,3081,2991,2677,1659,2040,440,395,1986,1702,1212,1776,5315,1143,2998,1618,3294,924,1774,822,1860,3133,625,939,1209,2154,3020,2155,1773,1771,703,3353,913,732,5401,893,582,1249,875,670,617,818,620,1206,451,586,2662,2047,1775,816,659,311,444,677,678,1022,1102,852,738,894,1779,2050,941,1213,1214,892,668,927,900,902,1988,2080,2970,718,1210,782,781,2037,439,3228,3229,2049,851,1617,3289,2804,3232,3244,2657,2156,557,2153,1241,623,58,887
		// 	]
		// }

        $.get(window.server_ip+"/matrixWorld",(data,status)=>{
            let m = JSON.parse(data)
            this.matrixWorld = new Matrix4().set(
                m[0],m[4],m[8],m[12],
                m[1],m[5],m[9],m[13],
                m[2],m[6],m[10],m[14],
                m[3],m[7],m[11],m[15])
            this.instanceGroup.applyMatrix4(this.matrixWorld)
        })
        
        this.startCulling()
    }
    
    startCulling(){
        var self = this
        setInterval(function(){
            self.pre_camera_position = self.camera.position
        },500)
        this.sceneCulling()
        setInterval(function(){
            self.processLoadList(
                [3465,2804,3547,2500,3475,3474,2504,2488,3548,3546,3576,2951,2839,2816,2949,2803,3533,2894,2892,3489,2795,3480,2543,2883,2882,2889,2957,3097,2812,2880,2809,2891,2888,2881,2810,2952,2884,2877,3476,2887,2875,2811,2893,2896,2874,2885,2873,2813,2396,2824,2113,2821,2814,2518,2863,2823,2870,2822,2871,2876,2963,730,2833,2895,2858,2818,2865,2515,2890,3550,2872,3551,2817,3485,2506,2878,2815,2886,2825,3560,2864,2806,2869,2519,2397,2827,2867,2807,3559,2829,3552,3557,3014,2499,2808,2828,2498,2842,2857,2879,3553,3555,2805,732,2819,2950,2849,2835,2830,2846,2856,2847,2861,2590,743,3132,2848,2862,2838,2841,2852,2520,2565,2860,2959,2834,2486,2832,2820,2487,2859,738,2868,2501,2866,3554,741,2826,2854,2505,2502,2964,2494,2503,3544,3537,2851,3055,3575,2489,2837,2844,2529,2831,3041,745,3498,728,2897,2576,3419,2855,3013,3541,2898,2850,3556,2107,2903,3539,744,2853,3026,2538,3134,3486,3028,2342,2905,2904,3086,729,826,2496,2845,2930,2962,1630,2484,3120,3133,2836,2958,2341,3572,2263,2843,2415,2340,2091,2447,2840,3534,2448,2900,726,3095,3098,3558,2544,2398,2411,3418,2115,2899,3087,3490,3497,3131,890,3569,3574,2522,2526,747,3432,3021,3477,1888,602,3500,3527,737,2492,2525,2416,3479,2524,3452,2801,2100,2521,724,3542,1979,3457,2045,3492,2932,3567,3088,2523,3535,2410,3112,2935,3487,725,2038,1174,734,3570,2449,3571,3488,748,2493,378,2264,3287,3481,3562,2259,2585,736,2497,173,2938,2258,3563,829,381,2924,2105,379,2427,2928,2262,3573,2441,2639,2907,695,2925,2941,2041,2917,2902,3090,197,2901,2037,2921,2249,380,3568,2995,2531,2495,2636,3460,2539,2796,2915,370,1642,3478,821,1651,770,2485,2587,3506,751,2561,2564,697,3122,2916,154,3012,3454,2787,2532,3504,2920,2278,2562,2216,3003,2558,803,2362,176,3005,3142,824,1195,2154,2559,2220,3549,2575,167,3042,2507,3459,2594,2084,1975,175,367,3499,181,2527,120,2083,3089,1980,2516,1231,25,1978,2579,2106,2148,2595,1232,2584,2339,1225,1220,2082,164,2276,2344,122,376,196,2572,3493,2797,2094,50,186,155,3540,2114,1774,2490,771,789,785,2510,596,3318,2430,194,2431,2434,3505,2433,2517,3528,2567,3536,2432,693,2914,2931,3011,2438,3141,2435,2412,1188,128,2437,2436,2102,2421,777,3006,2440,2439,2965,77,2939,1951,2092,2927,2413,2043,2414,2923,2401,2420,2422,2423,805,2081,2425,2424,2426,2036,700,2404,2994,2399,2406,3128,3129,178,3130,2400,2405,80,162,2407,2403,1167,2408,2409,2479,3545,773,3507,158,3491,1165,3496,1557,177,2101,3483,1199,2940,198,371,3443,1893,2369,2911,3147,2044,1163,3543,759,3482,735,3047,2291,3538,2261,2996,3068,606,3502,2343,3515,2786,1257,3503,3561,827,698,3121,1172,185,2305,188,107,3564,2112,2906,1898,180,2483,2455,127,2103,388,3073,2104,2465,752,3275,172,2802,2475,699,614,179,2469,2948,2480,2281,1161,2275,2574,3531,383,2968,521,2093,199,2010,2389,2035,2937,2443,2598,3015,2910,1905,2551,513,189,2418,2442,522,714,2089,3484,2528,3495,3143,876,2360,2070,911,1193,195,2085,106,2557,1138,3146,2152,3525,2269,1171,2513,3139,3494,3081,2108,2363,1185,163,115,3501,2922,2926,2668,484,3039,1154,1156,2975,2953,778,779,2578,786,148,2277,2792,157,2919,19,165,1229,1921,132,2361,2350,2566,2370,2560,2030,489,3060,1139,491,2371,510,2071,124,3508,882,528,557,166,530,3135,1157,2271,1223,897,1153,1159,2001,804,1078,712,2087,2569,493,259,1230,2012,123,2976,1897,875,1988,1168,2967,3071,2536,1961,3276,1934,1096,2090,140,3529,701,2007,608,2372,2419,1935,2057,3123,3124,2908,3530,1933,2395,1173,921,2031,498,2080,2218,2956,1632,243,27,2943,2944,2385,2096,711,597,1079,2212,713,2470,64,825,2272,1836,1894,356,168,2017,2966,3001,1955,3228,2111,2011,117,3153,475,1063,2537,2460,2097,2013,174,2117,2508,126,1158,2983,2384,2452,2942,2464,2462,1900,2934,353,2110,1049,2591,2095,547,541,2382,360,2451,2461,2491,2260,761,1169,1896,1160,1941,2086,615,2450,1884,170,1957,716,2349,549,883,1164,1987,873,2454,2473,2482,83,2478,2947,2545,2936,390,3154,2228,2472,2381,3137,2204,2476,2348,29,2471,2990,3522,2477,2359,492,715,3259,130,2474,546,550,2006,2481,1090,389,1140,2534,2352,3083,2336,1227,1977,2098,1947,2383,1074,2109,2351,1162,3518,184,2345,537,3517,3516,2022,1878,839,2099,696,3521,1166,567,1971,2954,762,1928,3520,361,592,551,895,30,215,1145,2991,497,1954,1887,1052,129,1925,1141,2347,114,874,603,386,1889,1994,1150,2982,1655,1170,2444,544,478,1973,2912,159,248,881,2992,2033,1191,1178,1742,2446,1142,879,1137,1939,1058,1086,577,878,2153,2568,121,613,182,2909,2042,1740,561,2798,1245,169,187,2535,369,584,1920,3524,203,2118,2116,877,3136,385,2213,2571,1050,482,494,1073,1991,564,575,2014,2542,1081,1981,2005,3140,1993,1077,1048,1047,2946,1886,507,382,1840,2547,214,685,1151,2192,534,3263,1964,2378,542,1176,387,1930,3511,3096,499,3155,1082,1968,880,580,1083,1080,595,486,2771,525,366,286,2337,2008,1919,531,2338,2049,2533,3101,3509,1331,569,1266,1434,1966,1054,1950,503,535,368,365,667,1927,1115,364,2018,573,2391,545,2054,1902,570,2573,1228,2588,156,1852,2335,1433,2219,1007,2392,2055,3102,590,1929,3436,211,2156,481,616,466,3519,2918,2913,834,3079,2142,2009,485,694,1926,601,2694,1183,1912,191,2215,548,593,2279,1147,1983,585,2394,1969,495,231,1924,161,1103,3027,2563,2393,2346,574,1084,1890,1667,532,241,604,2445,856,2640,3532,1226,1906,860,533,160,625,2530,2380,1221,1586,526,2050,1959,1119,205,3449,2597,171,581,1222,2993,2782,2390,1144,2047,1065,2375,609,1750,1899,1148,1180,1970,610,552,358,2155,1892,1218,565,523,618,190,1952,372,1537,1967,1953,1055,483,78,1061,1749,790,233,1197,1972,2032,3526,2021,1051,538,1901,1579,200,872,1891,677,500,192,563,1072,1247,1706,828,587,2373,1881,1192,1182,2367,3512,2699,2051,891,668,1903,1568,2402,2088,636,1883,2386,1146,1070,2769,2977,519,919,591,1053,1177,501,502,1175,193,579,791,1685,3206,1066,1528,1189,1249,2056,3248,568,131,3002,742,2428,524,202,1904,505,1200,749,1187,583,1603,220,2387,558,70,2945,283,516,1805,589,1184,1895,1885,760,125,1712,1143,576,2429,1963,3125,607,2280,1190,571,2029,896,3108,2667,2799,2015,2355,2377,3513,479,2004,2374,680,1949,1683,1060,1976,871,678,3251,1152,2356,1505,1923,1589,204,1186,862,285,727,566,1535,1224,1708,273,1958,2541,2777,3510,1593,731,3205,2268,266,1596,1672,1085,1670,280,559,3190,1751,3207,1940,1946,3435,1219,2788,517,1609,511,374,1590,2582,1071,2458,438,271,1194,887,2388,885,870,1960,1677,3246,1659,480,2677,848,2193,733,2376,1234,2379,3188,2456,2000,1581,316,1986,1440,2453,1155,553,212,1691,308,1614,2459,2457,1990,572,560,586,2463,514,617,1754,330,476,763,3250,1196,1181,1606,1809,1611,1149,543,1598,1608,2417,884,622,739,1615,1605,1582,1587,1201,3523,1776,2580,2040,582,2793,2980,886,1999,1696,1962,1682,1944,1509,373,2023,1997,889,1982,867,276,2972,469,750,605,2046,363,477,1533,297,3242,588,2048,147,2596,226,1069,1998,294,1911,2143,2468,1937,1435,1943,1057,1532,3461,3199,1948,515,490,1936,822,2999,3254,2002,2034,3126,619,3202,2760,1992,2298,1974,183,2467,780,1796,295,594,303,556,384,3127,375,3243,406,1076,612,1932,201,1942,1595,536,1945,1707,1580,1995,2929,740,1513,2368,362,2364,1597,894,1592,2955,3198,1664,1665,1251,2666,888,2354,1922,2638,3186,1241,1907,272,144,746,301,488,2691,1179,1613,456,2509,238,1607,1588,1068,1067,504,1710,1610,1612,1938,1494,1075,2620,487,237,611,1931,279,496,1956,1591,529,12,1985,1989,3200,600,1594,1243,1242,1056,892,1250,1604,893,2581,3208,3209,3185,3204,1753,1695,3241,1481,3240,1745,3187,1661,518,1118,377,2365,1835,555,1965,1439,1551,1436,3417,2681,2366,458,2358,3183,2357,2353,508,1036,1546,2302,2283,2292,262,527,520,512,509,554,506,539,2019,1510]
            )
        },500)
        this.animate = this.animate.bind(this)
        requestAnimationFrame(this.animate)
    }
    animate(){
        if(!this.camera.position.equals(this.pre_camera_position)){
            this.sceneCulling()
        }

        // else if(this.loadedModelList.length <= 3570){
        //     let load_list = []
        //     for(var i = 0; i < 3577;i++){
        //         if(!this.loadedModelList.includes(i)){
        //             load_list.push(i)
        //         }
        //     }
        //     if(load_list.length) this.processLoadList(load_list)
        // }
        // else if(this.toLoadModelList.length==0&&this.loadingModelList.length==0){
        //     this.prestrain()
        // }
        // this.setVisibility(this.visibleModelList)
        requestAnimationFrame(this.animate)
    }
    sceneCulling(){
        if(window.server_ip && this.matrixWorld && !this.httping){
            this.httping = true
            var frustumMat = new Matrix4().multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse)
            var unit_cull_data = JSON.stringify({
                mat:frustumMat.elements,
                pos:this.camera.position
            })
            $.post(window.server_ip+"/culling",unit_cull_data,(data,status)=>{
                this.httping = false
                let result = JSON.parse(data)
                this.visibleModelList = result
                this.length = result.length
                let load_list = []
                for(let i=0; i<result.length; i++){
                    if(!this.loadedModelList.includes(result[i])){
                        load_list.push(result[i])
                    }
                }
                if(load_list.length) this.processLoadList(load_list)
                
            })
            this.pre_camera_position = this.camera.position.clone()
        }
    }
    prestrain(){
        if(window.server_ip && this.matrixWorld && !this.httping){
            this.httping = true
            var frustumMat = new Matrix4().multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse)
            var unit_cull_data = JSON.stringify({
                mat:frustumMat.elements,
                pos:this.camera.position,
                name:this.id
            })
            $.post(window.server_ip+"/prestrain",unit_cull_data,(data,status)=>{
                this.httping = false
                let result = JSON.parse(data)
                console.log(result)
                this.visibleModelList = result
                this.length = result.length
                let load_list = []
                for(let i=0; i<result.length; i++){
                    if(!this.loadedModelList.includes(result[i])){
                        load_list.push(result[i])
                    }
                }
                if(load_list.length) this.processLoadList(load_list)
                
            })
            this.pre_camera_position = this.camera.position.clone()
        }
    }
    setVisibility(list){
        var vis_num = 0
        for(let i=0; i<this.loadedModelList.length; i++){
            let index = this.loadedModelList[i]
            if(index != 0)
                var index_t = '_0_'+this.loadedModelList[i].toString()
            else
                var index_t = '_0'
            if(this.loaded_mesh[index_t]){
                this.loaded_mesh[index_t].material[0].opacity = this.op
                if(list.includes(index)){   // 可见
                    this.loaded_mesh[index_t].visible = true
                    vis_num++
                }else{                   // 不可见
                    this.loaded_mesh[index_t].visible = true
                }
            }
        }
    }

    processLoadList(load_list){
        if(this.loading){
	  // 若还在加载中，更新待加载列表
            let new_to_load_list = []
            for(let i=0; i<load_list.length; i++){
                let ind = load_list[i]
                if(!this.loadingModelList.includes(ind) && !this.loadedModelList.includes(ind)){
                    new_to_load_list.push(ind)
                }
            }
            this.toLoadModelList = new_to_load_list
        }else{              // 若加载结束，更新加载列表和待加载列表
            let new_to_load_list = []
            for(let i=0; i<load_list.length; i++){
                let ind = load_list[i]
                if(i<this.loadlimit){
                    this.loadingModelList.push(ind)
                }else{
                    new_to_load_list.push(ind)
                }
            }
            this.toLoadModelList = new_to_load_list
            this.loading = true
            for(let i=0; i<this.loadingModelList.length; i++){
                this.loadModelZip(this.loadingModelList[i])
            }
        }
    }
    loadModelZip(index){
        var self = this
        var url = "assets/models/"+self.projectName+"/"+index+".zip"
        var loader = new LoadingManager()
        new Promise(function(resolve,reject){
            new ZipLoader().load(url,()=>{
            },()=>{
                console.log("模型加载失败："+index)
                setTimeout(()=>{
                    self.loadModelZip(index)
                },1000*(0.5*Math.random()+1))
            }).then((zip)=>{
                // console.log(self.loadingModelList.indexOf(index))
                self.loadingModelList.splice(self.loadingModelList.indexOf(index),1)
                self.loadedModelList.push(index)
                if(self.loadingModelList.length===0){       // 若加载序列结束
                    self.loading = false                // 若待加载序列结束，则结束加载
                    if(self.toLoadModelList.length!==0){    // 若待加载序列未结束，继续加载
                        self.processLoadList(self.toLoadModelList)
                    }
                }
                loader.setURLModifier(zip.urlResolver)
                resolve()
            })
        }).then(function(){
            new FileLoader(loader).load("blob:assets/models/"+self.projectName+"/matrix"+index+".json",json=>{
                var matrix = JSON.parse(json)
                new GLTFLoader(loader).load("blob:assets/models/"+self.projectName+"/model"+index+".glb", (gltf)=>{
                    var mesh = gltf.scene.children[0].children[0]
                    self.addInsModel(matrix,mesh)
                })
            })
        })
    }
    addInsModel(matrix,mesh){
        let index = mesh.name
        matrix.push([1,0,0,0,0,1,0,0,0,0,1,0])
        let matrix4List = []
        for(let j=0; j<matrix.length; j++){
            let mat = matrix[j]
            matrix4List.push(new Matrix4().set(
                mat[0], mat[1], mat[2], mat[3],
                mat[4], mat[5], mat[6], mat[7],
                mat[8], mat[9], mat[10], mat[11],
                0, 0, 0, 1))
        }
        mesh.material.transparent = true
        // console.log(mesh.material.side)
        mesh.material.side = 2
        let instance_mesh = processMesh(mesh,matrix4List)
        this.instanceGroup.add(instance_mesh)
        this.loaded_mesh[index] = instance_mesh
    }
}

function disposeInsMesh(instanceMesh){
    if(!instanceMesh) return
    instanceMesh.geometry.clearGroups()
    instanceMesh.geometry.dispose()
    instanceMesh.material[0].dispose()
    for(let key in instanceMesh)
        delete instanceMesh[key]
}

function processMesh(mesh,matrixList){
    var instancedMesh = new InstancedMesh(mesh.geometry, [mesh.material], 1, [matrixList.length], false)
    instancedMesh.geometry.clearGroups()
    instancedMesh.geometry.addGroup(0, mesh.geometry.index.array.length)
    instancedMesh.instanceMatrix.needsUpdate=true
    for(let i=0; i<matrixList.length; i++){
        var instanceMatrix = matrixList[i]
        instancedMesh.setMatrixAt(i, instanceMatrix)
    }
    return instancedMesh
}
